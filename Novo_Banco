saldo = 0
numero_saques = 0
adiciona_saldo = 0
remove_saldo = 0
movimentacoes = []
usuarios = []
contas = []
cpf_usado = False

def fn_menu ():
    menu = input(
    
    """

        Seja bem-vindo ao banco Chaotix, o que gostaria de fazer hoje?

        [1] Criar Usuario
        [2] Criar Cadastro Bancario
        [3] Depositar
        [4] Sacar
        [5] Ver extrato
        [0] Sair

        Insira o número da sua resposta:
    """

    
    )
    return menu

while True:
    escolha = fn_menu()
    if escolha == "1":

        cpf = input('Você selecionou "Criar Usuario", responda a pergunta abaixo:' \
            'Qual é o seu CPF?')
        cpf_usado = False
        
        for usuario in usuarios:
            if usuario["cpf"] == cpf:
                cpf_usado = True

        if cpf_usado == True:
            retorno = input("CPF USADO! Deseja voltar ao menu? [S/N]")

            if retorno == "S":
                continue

            elif retorno == "N":
                print("Agradecemos por escolher os bancos Chaotix! Volte sempre!")
                exit()

            else:
                print("Resposta errada, reinicie o programa.")

        else:
            nome = input("Qual seu nome?")
            nascimento = input("Qual sua data de nascimento?")
            print("Agora responda as perguntas sobre teu endereço?")
            logradouro = input("Logradouro: ")
            numero = input("Número: ")
            bairro = input("Bairro: ")
            cidade = input("Cidade: ")
            estado = input("Sigla do Estado: ")
            endereco = f"{logradouro}, {numero} - {bairro} - {cidade}/{estado}"

            usuario = {
            "cpf": cpf,
            "nome": nome,
            "nascimento": nascimento,
            "endereco": endereco
            }
            usuarios.append(usuario)
            retorno = input("Seu usuario foi criado com sucesso! " \
            "Gostaria de voltar ao menu? [S/N]")

            if retorno == "S":
                continue 

            elif retorno == "N":
                print("Agradecemos por escolher o banco Chaotix! Volte sempre!")
                break  
                
            else:
                print("Resposta errada, programa reiniciando.")
                continue          
    elif escolha == "2":
        cpf = input('Você selecionou "Criar Cadastro Bancario", ' \
        'Informe o CPF do usuário já cadastrado:')
        
        usuario_encontrado = None
        for usuario in usuarios:
            if usuario["cpf"] == cpf:
                usuario_encontrado = usuario
                break

        if usuario_encontrado:
            numero_conta = len(contas) + 1  
            conta = {
                "agencia": "0001",
                "numero_conta": numero_conta,
                "usuario": usuario_encontrado,
                "saldo": 0,
                "movimentacoes": []
            }
            contas.append(conta)
            print(f"Conta criada com sucesso! Agência: 0001 | Conta: {numero_conta}")
            retorno = input("Deseja voltar ao menu? [S/N] ")
            if retorno == "S":
                continue
            else:
                print("Agradecemos por escolher o banco Chaotix! Volte sempre!")
                break
        else:
            print("Usuário não encontrado! Cadastre o usuário antes de criar a conta.")
            retorno = input("Deseja tentar novamente? [S/N] ")
            if retorno == "S":
                continue
            else:
                print("Encerrando o programa.")
                break
    elif escolha == "3":
        cpf = input("Informe o CPF do titular da conta: ")
        conta_encontrada = None
        for conta in contas:
            if conta["usuario"]["cpf"] == cpf:
                conta_encontrada = conta
                break

        if conta_encontrada:
            valor = float(input("Informe o valor para depósito: "))
            if valor > 0:
                conta_encontrada["saldo"] += valor
                conta_encontrada["movimentacoes"].append(f"Depósito: R$ {valor:.2f}")
                print(f"Depósito realizado! Saldo atual: R$ {conta_encontrada['saldo']:.2f}")
                retorno = input("Deseja voltar ao menu? [S/N] ")
                if retorno == "S":
                    continue
                else:
                    print("Agradecemos por escolher o banco Chaotix! Volte sempre!")
                    break
            else:
                print("Valor inválido.")
        else:
            print("Conta não encontrada.")        
    elif escolha == "4":
        cpf = input("Informe o CPF do titular da conta: ")
        conta_encontrada = None
        for conta in contas:
            if conta["usuario"]["cpf"] == cpf:
                conta_encontrada = conta
                break

        if conta_encontrada:
            limite_valor = 500
            limite_saques = 3
            saques_realizados = sum(1 for mov in conta_encontrada["movimentacoes"] if "Saque" in mov)

            if saques_realizados >= limite_saques:
                print("Limite diário de saques atingido.")
            else:
                valor = float(input("Informe o valor para saque: "))
                if valor > conta_encontrada["saldo"]:
                    print("Saldo insuficiente!")
                elif valor > limite_valor:
                    print(f"Valor acima do limite permitido (R$ {limite_valor:.2f}).")
                elif valor > 0:
                    conta_encontrada["saldo"] -= valor
                    conta_encontrada["movimentacoes"].append(f"Saque: R$ {valor:.2f}")
                    print(f"Saque realizado! Saldo atual: R$ {conta_encontrada['saldo']:.2f}")
                else:
                    print("Valor inválido.")
        else:
            print("Conta não encontrada.")
    elif escolha == "5":
        cpf = input("Informe o CPF do titular da conta: ")
        conta_encontrada = None
        for conta in contas:
            if conta["usuario"]["cpf"] == cpf:
                conta_encontrada = conta
                break

        if conta_encontrada:
            print("\n===== EXTRATO =====")
            if len(conta_encontrada["movimentacoes"]) == 0:
                print("Nenhuma movimentação realizada.")
            else:
                for mov in conta_encontrada["movimentacoes"]:
                    print(mov)
            print(f"\nSaldo atual: R$ {conta_encontrada['saldo']:.2f}")
            print("====================")

            retorno = input("Deseja voltar ao menu? [S/N] ")
            if retorno == "S":
                continue
            else:
                print("Agradecemos por escolher o banco Chaotix! Volte sempre!")
                break
        else:
            print("Conta não encontrada.")  
    elif escolha == "0":
        print("Agradecemos por escolher os bancos Chaotix! Volte sempre!")
        exit()   
    else:
        retorno = input("Resposta invalida! " \
        "Gostaria de voltar ao menu? [S/N]")
        if retorno == "S":
            continue
        elif retorno == "N":
            print("Agradecemos por escolher os bancos Chaotix! Volte sempre!")
            exit()
        else:
            print("Resposta errada, reinicie o programa.")